---
title: "Assignment 4 - Spiny Lobsters"
author: "Vanessa Rathbone and Nicole Schmidt"
date: "11/12/2019"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
```

### TEST TEXT ADD

```{r}
# Attach library packages
# Read in data and tidy it

library(tidyverse)
library(purrr)
library(ggplot2)
library(janitor)
library(kableExtra)
library(plotly)

# Read in data and tidy it using clean_names() and uncount()

lobster_tidy <- readr::read_csv("lobster_abundance_sbc_lter.csv",
na = "-99999") %>% 
  clean_names() %>% 
  tidyr::uncount(count)

# need to find standard diviation of lobster size distribution 
# because it's a distribution plot we may want to consider a density or histogram plot
  

```

##### INTRO (both)
# need to rewrite
# add image of a spiny lobster and the map of the locations? if so, add references to bottom

Abstract:	
Data on abundance, size and fishing pressure of California spiny lobster (Panulirus interruptus) are collected along the mainland coast of the Santa Barbara Channel. Spiny lobsters are an important predator in giant kelp forests off southern California. Two SBC LTER study reefs are located in or near the California Fish and Game Network of Marine Protected Areas (MPA), Naples and Isla Vista, both established as MPAs on 2012-01-01. MPAs provide a unique opportunity to investigate the effects of fishing on kelp forest community dynamics. Sampling began in 2012 and is ongoing.

This dataset contains two tables. 1) Abundance and size data collected annually by divers in late summer before the start of the fishing season at five SBC LTER long term kelp forest study sites: two within MPAs (Naples and Isla Vista) and three outside (Arroyo Quemado, Mohawk and Carpinteria). 2) Fishing pressure, as determined by counting the number of commercial trap floats. Data are collected every two to four weeks during the lobster fishing season (October to March) at nine sites along the mainland, eight of which are also SBC LTER long-term kelp forest study reefs.

![](lob_pic.jpg)
**Figure 1.** *California spiny lobster (Panulirus interruptus). Credit: [Golden State Images](http://www.goldenstateimages.com/GSI_big.php?img=LOB-005).*

![](lob_sites.png)

**Figure 2.** *Spacial Coverage of the five data sites. Credit:  [Santa Barbara Coastal LTER, Danial C. Reed](https://portal.edirepository.org/nis/mapbrowse?scope=knb-lter-sbc&identifier=77&revision=newest)*

##### DATA AND METHODS (both)
```{r}

```

###### RESULTS A: Abundance of lobsters per site
```{r}

# RESULTS A
# Create data frame for results A

lobster_ysite_a <- lobster_tidy %>% 
  count(year, site) %>% 
  mutate("MPA" = ifelse(site == "IVEE", "MPA",
                        ifelse(site == "NAPL", "MPA",
                               "non-MPA"))) %>% 
  mutate("site_name" = ifelse(site == "IVEE", "Isla Vista",
                              ifelse(site == "NAPL", "Naples",
                                     ifelse(site == "AQUE", "Arroyo Quemado",
                                            ifelse(site == "CARP", "Carpenteria",
                                            "Mohawk")))))


```
```{r}

# RESULTS A: 
# Visually explore the data, explore by site

# Jitterplot 
ggplot(lobster_tidy, aes(x = site, y = size_mm)) +
  geom_jitter()

# Violin plot: 
ggplot(lobster_tidy, aes(x = site, y = size_mm)) +
  geom_violin()

# Histogram: 
ggplot(lobster_tidy, aes(x = size_mm)) +
  geom_histogram() +
  facet_wrap(~site)

# QQ plot: 
ggplot(lobster_tidy, aes(sample = size_mm)) +
  geom_qq() +
  facet_wrap(~site)

```

```{r}

# RESULTS A: 
# Create graph for lobster count per site per year

ggplot(data = lobster_ysite_a, aes(x = year,
                                   y = n)) +
  geom_line(aes(color = site))+
  labs(x = "Year",
       y = "Lobster Count",
       title = "Lobster Count in Santa Barbara LTER")
  
            
            
# scale_color_manual(breaks = c("MPA", "non-MPA"), values = c("blue", "orange")

```



###### RESULTS B: Lobster size distribution shifts in 2012 & 2018

```{r}

# RESULTS B
# Q: Is there a significance difference in lobster size distribution shifts in 2012 and 2018.
# Data sets for lobster size distribution shifts in 2012 and 2018, together and separately

lobster_12_18 <- lobster_tidy %>%
  filter(year %in% c(2012, 2018)) # 2036 observations 

lobster_12 <- lobster_tidy %>% # 231 observations 
  filter(year == "2012")

lobster_18 <- lobster_tidy %>% # 1805 observations 
  filter(year == "2018")

# Based on Central Limit Theorem, the sampling distribution of means in 2018 will be normally distributed because there are 1805 observations. There are 231 observations in the 2012 data, and because of the Central Limit Theorem, we can also assume normally distributed means, regardless of underlying population. Therefore, comparing means using a t-test is OK and we believe the means are a useful metric of comparison. CLT = sampling distribution of the means will be normal.

# Visually explore the data: 

# Histograms: 

ggplot(lobster_12, aes(x = size_mm)) +
  geom_histogram()

ggplot(lobster_18, aes(x = size_mm)) +
  geom_histogram()

# QQ plots:

ggplot(lobster_12, aes(sample = size_mm)) +
  geom_qq()

ggplot(lobster_18, aes(sample = size_mm)) +
  geom_qq()

```

```{r}

# RESULTS B
# Wrangling data to create a data frame that keeps size measurements from the year 2012 and 2018. 

lobster_size_b <- read_csv("lobster_abundance_sbc_lter.csv", na = "-99999") %>% 
  clean_names() %>% 
  filter(year %in% c(2012, 2018)) %>% 
  group_by(site, year) %>% 
  select(year, size_mm, site) %>% 
  mutate("MPA" = ifelse(site == "IVEE", "MPA",
                        ifelse(site == "NAPL", "MPA",
                               "non-MPA"))) %>%
  mutate("site_name" = ifelse(site == "IVEE", "Isla Vista",
                              ifelse(site == "NAPL", "Naples",
                                     ifelse(site == "AQUE", "Arroyo Quemado",
                                            ifelse(site == "CARP", "Carpenteria",
                                            "Mohawk"))))) %>% 
   mutate(protected = case_when(
    site == "IVEE" ~ "MPA",
    site == "NAPL" ~ "MPA",
    site == "AQUE" ~ "Non-MPA",
    site == "CARP" ~ "Non-MPA",
    site == "MOHK" ~ "Non-MPA"))

```

```{r}

# RESULTS B
# Graph exploration 
# Create a box plot option 1

ggplot(data = lobster_size_b, aes(x = site_name, y = size_mm))+
  geom_jitter(aes(color = site_name),
              show.legend = FALSE)+
  #scale_x_discrete(limits = "AQUE", "CARP","MOHK","IVEE", "NAPL")+
  #scale_fill_discrete(name = "Protected Status")
  geom_boxplot(aes(fill = year), alpha = 0.5, outlier.color = NA, fill = "light blue")+
  labs(x = "Year",
      y = "Size (mm)",
      title = "Lobster size distribution shifts in Santa Barbara LTER")+
  labs(x = "Year", y = "Lobster Size (mm)")+
  scale_color_manual(breaks = c("MPA", "non-MPA"), values = c("orange", "orange", "orange", "light blue", "light blue")) +
  theme_classic()+
    scale_color_manual(breaks = c("MPA", "non-MPA"), values = c("orange", "orange", "orange", "light blue", "light blue"))+
    facet_wrap(~ year)

# need to fix graph so that the colors correspond with MPA and non-MPA. Also need to fix site names to be vertical

# OPTION 2: 
#Create New data frame for MPA only data, and data only from 2012 and 2018

MPA_12_18 <- lobster_tidy %>% 
  filter(year == "2012" | year == "2018") %>% 
  mutate(protected = case_when(
    site == "IVEE" ~ "MPA",
    site == "NAPL" ~ "MPA",
    site == "AQUE" ~ "Non-MPA",
    site == "CARP" ~ "Non-MPA",
    site == "MOHK" ~ "Non-MPA"))

MPA_graph_12_18 <- ggplot(MPA_12_18, aes(x= site, y= size_mm)) +
  geom_boxplot(aes(fill = protected)) +
  facet_wrap(~ year) +
  theme_classic() +
  scale_x_discrete(limits = c("AQUE", "CARP", "MOHK", "IVEE", "NAPL")) +
  labs(x = "Site",
       y = "Carapace Length (mm)",
       title = "Size Distribution of Lobsters at Santa Barbara Channel LTER Sites (2012 + 2018") +
  scale_fill_discrete(name = "Protected Status")

MPA_graph_12_18 + theme(panel.spacing = unit(3, "lines")) 

# Need to decide which one we think does a better job at responsibly and clearly describing the data

```

###### RESULTS C: Compare mean lobster sizes at MPA vs. non-MPA sites in 2012 and 2018
```{r}

# RESULTS C
# Wrangle data for means 
# Create new data set for lobster size means for MPA vs non-MPA 2012 and 2018

lobster_means <- lobster_size_b %>% 
  group_by(MPA) %>% 
  summarise(mean_mm = mean(size_mm, na.rm = TRUE))

# Create two data frames, one for 2012 and one for 2018, Lobster size means to compare size at mpa vs non-MPA sites

lobster_2012_mean <- lobster_size_b %>% 
  filter(year == 2012) %>% 
  group_by(MPA) %>% 
  summarise(mean_mm = mean(size_mm, na.rm = TRUE),
            sd_size = sd(size_mm, na.rm = TRUE),
            sample_n = n())
  
lobster_2018_mean <- lobster_size_b %>% 
   filter(year == 2018) %>% 
  group_by(MPA) %>% 
  summarise(mean_mm = mean(size_mm, na.rm = TRUE), 
            sd_size = sd(size_mm, na.rm = TRUE),
            sample_n = n())

```

```{r}

# RESULTS C
# Use a t-test to find confidence intervals between MPA and non-MPA

t_test_MPA <- lobster_size_b %>% 
  filter(MPA == "MPA") %>% 
  pull(size_mm)

t.test(t_test_MPA)

t_test_non_MPA <- lobster_size_b %>% 
  filter(MPA == "non-MPA") %>% 
  pull(size_mm)

t.test(t_test_non_MPA)

# Use a t-test to find confidence intervals between MPA and nonMPA in 2012

```


##### SUMMARY 
```{r}

```

##### REFERENCES

Reed D. 2019. SBC LTER: Reef: Abundance, size and fishing effort for California Spiny Lobster (Panulirus interruptus), ongoing since 2012. Environmental Data Initiative. https://doi.org/10.6073/pasta/a593a675d644fdefb736750b291579a0. Dataset accessed 10/30/2019.

